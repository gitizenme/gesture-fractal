<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.10: http://docutils.sourceforge.net/" />
<title>Understanding the Objective-C Sample Application</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id$
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="understanding-the-objective-c-sample-application">
<h1 class="title">Understanding the Objective-C Sample Application</h1>

<p>This article discusses the Objective-C sample application included with the Leap SDK. After reading this article, you should be ready to access Leap hand tracking data from your own Objective-C applications.</p>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics:</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#using-the-leap-objective-c-wrapper" id="id2">Using the Leap Objective-C Wrapper</a></li>
<li><a class="reference internal" href="#creating-a-leapcontroller-object" id="id3">Creating a LeapController object</a></li>
<li><a class="reference internal" href="#adopting-the-leapdelgate-protocol" id="id4">Adopting the LeapDelgate Protocol</a></li>
<li><a class="reference internal" href="#getting-a-frame-of-data" id="id5">Getting a Frame of data</a></li>
<li><a class="reference internal" href="#running-the-sample" id="id6">Running the sample</a></li>
</ul>
</div>
<p>In the Leap SDK folder, you can find the following files used for this article:</p>
<ul class="simple">
<li><tt class="docutils literal">Leap_SDK/samples/SampleObjectiveC.xcodeproj</tt> — Xcode project file.</li>
<li><tt class="docutils literal">Leap_SDK/samples/ObjectiveC/Sample.h</tt> — Header file for the sample code which interacts with the Leap library.</li>
<li><tt class="docutils literal">Leap_SDK/samples/ObjectiveC/Sample.m</tt> — Sample code that interacts with the Leap library to print out tracking data.</li>
<li><tt class="docutils literal">Leap_SDK/samples/ObjectiveC/*</tt> — Miscellaneous standard OS X application files.</li>
<li><tt class="docutils literal">Leap_SDK/include/LeapObjectiveC.h</tt> — Header file for the Leap Objective C++ wrapper.</li>
<li><tt class="docutils literal">Leap_SDK/include/LeapObjectiveC.mm</tt> — Objective C++ wrapper for the Leap library.</li>
<li><tt class="docutils literal">Leap_SDK/include/Leap.h</tt> — Leap C++ API class and struct definitions.</li>
<li><tt class="docutils literal">Leap_SDK/include/LeapMath.h</tt> — Leap C++ API Vector and Matrix class and struct definitions.</li>
<li><tt class="docutils literal">Leap_SDK/lib/libLeap.dylib</tt> — Leap library for Mac.</li>
</ul>
<p>All the files needed for the sample application are already referenced in the SampleObjectiveC Xcode project file.</p>
<p>Also note that you can find the Leap API reference documentation at <a class="reference external" href="API_Reference/annotated.html">Leap_SDK/docs/API_Reference/annotated.html</a>.</p>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#id1">Overview</a></h1>
<p>In a nutshell, the Leap motion tracking device detects and tracks hands and fingers placed within its field of view. The Leap captures this data one <em>frame</em> at a time. Your applications can use the Leap API to access this data.</p>
<p>The sample application demonstrates how to use the Leap API to listen for frame events dispatched by the Leap and how to access the hand and finger data in each frame. The application is a small  program that prints information about detected hands and fingers to standard output. The application is contained in a single file, <tt class="docutils literal">Sample.cpp</tt>.</p>
<p>The sample application uses most of the key classes in the Leap API, including:</p>
<ul class="simple">
<li><tt class="docutils literal">LeapController</tt> — the interface between the Leap and your application</li>
<li><tt class="docutils literal">LeapDelegate</tt> — used to handle events dispatched by the Leap</li>
<li><tt class="docutils literal">LeapFrame</tt> — contains a set of hand and finger tracking data</li>
<li><tt class="docutils literal">LeapHand</tt> — contains tracking data for a detected hand</li>
<li><tt class="docutils literal">LeapFinger</tt> — contains tracking data for a detected finger</li>
<li><tt class="docutils literal">LeapVector</tt> — represents a 3D position or directional vector</li>
</ul>
<p>For more detailed information about these classes, pleases refer to the Leap API reference documentation.</p>
</div>
<div class="section" id="using-the-leap-objective-c-wrapper">
<h1><a class="toc-backref" href="#id2">Using the Leap Objective-C Wrapper</a></h1>
<p>The Objective-C wrapper translates the classes in the standard Leap C++ API into classes that can be used directly from Objective-C.</p>
<p>The main difference between the Objective-C API and the Leap C++ API is that the Listener callback mechanism is replaced with the LeapDelegate protocol. Any class adopting the LeapDelegate protocol can be added as a delegate to a LeapController instance to receive tracking data. Another difference in the two APIs is that the class names of the Objective-C wrapper use the prefix <tt class="docutils literal">Leap</tt>. Thus, the C++ <tt class="docutils literal">Controller</tt> class is named <tt class="docutils literal">LeapController</tt> in Objective-C.</p>
</div>
<div class="section" id="creating-a-leapcontroller-object">
<h1><a class="toc-backref" href="#id3">Creating a LeapController object</a></h1>
<p>The <tt class="docutils literal">LeapController</tt> class provides the main interface between the Leap and your application. When you create a LeapController object, it connects to the Leap software running on the computer and makes hand tracking data available through <tt class="docutils literal">LeapFrame</tt> objects. You can access these Frame objects by instantiating a LeapController object and calling the object's <tt class="docutils literal">frame:history</tt> method.</p>
<p>If your application has a natural update loop or frame rate, then you can call the LeapController <tt class="docutils literal">frame:history</tt> method as part of this update. Otherwise, you can add a delegate to the controller object. The controller object invokes the methods defined in your <tt class="docutils literal">LeapDelegate</tt> implementation whenever a new frame of tracking data is available (and also for a few other Leap events).</p>
<p>The sample application creates a LeapController object in the <tt class="docutils literal">run</tt> method of the Sample class. The Sample class adopts the LeapDelegate protocol and adds itself to the LeapController object so that it can receive the Leap events:</p>
<pre class="objc literal-block">
- (void)run
{
    controller = [[LeapController alloc] init];
    [controller addDelegate:self];
    NSLog(&#64;&quot;running&quot;);
}
</pre>
</div>
<div class="section" id="adopting-the-leapdelgate-protocol">
<h1><a class="toc-backref" href="#id4">Adopting the LeapDelgate Protocol</a></h1>
<p>The Sample class implements the methods in the LeapDelegate protocol to handle events dispatched by the Leap. The methods include:</p>
<ul class="simple">
<li><tt class="docutils literal">onInit:aController</tt> — dispatched once, when the controller to which the delegate is registered is initialized.</li>
<li><tt class="docutils literal">onConnect:aController</tt> — dispatched when the controller connects to the Leap and is ready to begin sending frames of motion tracking data.</li>
<li><tt class="docutils literal">onDisconnect:aController</tt> — dispatched if the controller disconnects from the Leap (for example, if you unplug the Leap device or shut down the Leap software).</li>
<li><tt class="docutils literal">onExit:aController</tt> — dispatched to a delegate when it is removed from a controller.</li>
<li><tt class="docutils literal">onFrame:aController</tt> — dispatched when a new frame of motion tracking data is available.</li>
</ul>
<p>In the four lifecycle events callbacks, <tt class="docutils literal">onInit</tt>, <tt class="docutils literal">onConnect</tt>, <tt class="docutils literal">onDisconnect</tt>, and <tt class="docutils literal">onExit</tt> the sample application simply prints a message to the NSLog output. For the <tt class="docutils literal">onFrame</tt> event, the delegate implementation does a bit more work. When the controller calls the <tt class="docutils literal">onFrame:aController</tt>, the method gets the latest frame of motion tracking data and prints information about the detected objects to the NSLog output.</p>
</div>
<div class="section" id="getting-a-frame-of-data">
<h1><a class="toc-backref" href="#id5">Getting a Frame of data</a></h1>
<p>The LeapController object calls the delgate's <tt class="docutils literal">onFrame:aController</tt> method when the Leap generates a new frame of motion tracking data.  You can access the new data by calling the LeapController <tt class="docutils literal">frame:history</tt> method, which returns the newest LeapFrame object. (A reference to the LeapController object is passed to the delegate method as a parameter.) A LeapFrame object is the top level of the Leap model heirarchy and provides such information as a frame ID, a timestamp, and lists containing the hands, fingers, and tools in view.</p>
<p>The following code defined in the Sample class's implementation of the <tt class="docutils literal">onFrame:aController</tt> method gets the most recent LeapFrame object from the controller, retrieves the list of LeapHands from the LeapFrame and then logs the frame ID, timestamp, and the number of hands, fingers, and tools detected in the frame:</p>
<pre class="objc literal-block">
// Get the most recent frame and report some basic information
LeapFrame* frame = [aController frame:0];
NSLog(&#64;&quot;Frame id: %lld, timestamp: %lld, hands: %ld, fingers: %ld, tools: %ld&quot;,
      [frame id], [frame timestamp], [[frame hands] count],
      [[frame fingers] count], [[frame tools] count]);
</pre>
<p>The method goes on to examine the first hand in the list of hands:</p>
<pre class="objc literal-block">
if (![[frame hands] empty]) {
    // Get the first hand
    LeapHand* hand = [[frame hands] objectAtIndex:0];
</pre>
<p>A LeapHand object contains an ID, properties representing the hand's physical characteristics, and a list of LeapFinger objects. Each LeapFinger object contains an ID and properties representing the characteristic of the finger.</p>
<p>Once it has retrieved a hand, the method checks it for fingers and then averages the finger tip positions, printing the result with the number of fingers:</p>
<pre class="objc literal-block">
// Check if the hand has any fingers
NSArray* fingers = [hand fingers];
if (![fingers empty]) {
    // Calculate the hand's average finger tip position
    LeapVector* avgPos = [[[LeapVector alloc] init] autorelease];
    for (int i = 0; i &lt; [fingers count]; i++) {
        LeapFinger* finger = [fingers objectAtIndex:i];
        avgPos = [avgPos plus:[finger tipPosition]];
    }
    avgPos = [avgPos divide:[fingers count]];
    NSLog(&#64;&quot;Hand has %ld fingers, average finger tip position %&#64;&quot;,
          [fingers count], avgPos);
}
</pre>
<p>Next, the method prints the radius of a sphere fit to the hand's curvature, along with the hand's palm position:</p>
<pre class="objc literal-block">
// Get the hand's sphere radius and palm position
NSLog(&#64;&quot;Hand sphere radius: %f mm, palm position: %&#64;&quot;,
      [hand sphereRadius], [hand palmPosition]);
</pre>
<p>Finally, the <tt class="docutils literal">onFrame:aController</tt> method uses LeapVector class methods to get the hand's pitch, roll, and yaw angles from the hand's normal vector and the direction vectors. The angles are converted from radians to degrees:</p>
<pre class="objc literal-block">
// Get the hand's normal vector and direction
const LeapVector* normal = [hand palmNormal];
const LeapVector* direction = [hand direction];

// Calculate the hand's pitch, roll, and yaw angles
NSLog(&#64;&quot;Hand pitch: %f degrees, roll: %f degrees, yaw: %f degrees\n&quot;,
      [direction pitch] * LEAP_RAD_TO_DEG,
      [normal roll] * LEAP_RAD_TO_DEG,
      [direction yaw] * LEAP_RAD_TO_DEG);
</pre>
</div>
<div class="section" id="running-the-sample">
<h1><a class="toc-backref" href="#id6">Running the sample</a></h1>
<p>To run the sample application:</p>
<ol class="arabic simple">
<li>Plug the Leap device into a USB port and place it in front of you.</li>
<li>If you haven't already, install the Leap software.</li>
<li>Start the Leap software. If prompted, enter your registered email address and password. The Leap icon appears on the finder bar and turns green when ready.</li>
<li>Open the SampleObjectiveC project file in Xcode.</li>
<li>Press the Xcode <em>Run</em> button.</li>
</ol>
<p>You should see the messages &quot;Initialized&quot; and &quot;Connected&quot; printed to Debug Output area in Xcode when the application initializes and connects to the Leap. You should then see frame information printed to the Debug Output area each time the Leap dispatches the <tt class="docutils literal">onFrame</tt> event. When you place a hand above the Leap, you should also see finger and palm position information printed. Note that the application window is intentionally left blank. All output appears in the Xcode Debug Output area.</p>
<p>Now that you have seen how to access motion tracking data from the Leap, you can begin developing your own Objective-C applications that integrate the Leap.</p>
<hr class="docutils" />
<p>Copyright © 2012-2013 Leap Motion, Inc. All rights reserved.</p>
<p>Leap Motion proprietary and confidential. Not for distribution. Use subject to the terms of the Leap Motion SDK Agreement available at <a class="reference external" href="https://developer.leapmotion.com/sdk_agreement">https://developer.leapmotion.com/sdk_agreement</a>, or another agreement between Leap Motion and you, your company or other organization.</p>
</div>
</div>
</body>
</html>
